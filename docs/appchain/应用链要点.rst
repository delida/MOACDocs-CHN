应用链要点
^^^^^^^^^^^^^^^

概述
----------------------

应用链（AppChain），也称子链（MicroChain，SubChain）是在母链之上的独立的区块链系统，应用链中的每个节点称为scs，scs的通讯通过母链，并定期向母链进行数据背书。应用链上可以单独跑业务逻辑，母链无需了解。

母链账户地址和应用链账户地址是同一体系，可以通用，但在在不同的链上为不同链的货币进行服务，互相之间除非充提否则没有联系。

母链上可以跑多条应用链，MOAC采用分片技术，随机将scs分配给不同的应用链。

应用链需要依赖于母链来运行，因此，运行一条应用链需要M个母链节点（vnode）和N个应用链节点（scs）。

普通应用链节点scs可以称作应用链矿工，其主要负责应用链的出块，是维持一条应用链稳定安全运行的根本。

应用链节点下的母链节点，需要选取一部分注册成vnode代理的节点，vnode代理节点的作用是用于维护应用链稳定运行，vnode代理节点同样有一个代理矿工池

部署应用链控制合约时需要指定以上两个池子的地址。

应用链合约部署完后，即可调用registeropen来召唤池子里的scs注册；当数量达到预期后，就可以调用registerclose来初始化应用链区块，让应用链开始运行。

应用链需要每隔一段时间发起flush操作，将关键状态写入母链进行背书。除此之外，flush还将完成节点收益分配和有币区块链的母应用链充提操作。

可以调用应用链控制合约里的registerasmonitor来将一个应用链节点注册成一个侦听节点。侦听节点只负责信息查询，不参与普通应用链节点的服务，适合dapp用户部署来监控应用链运行状态。

如果普通应用链节点状态不稳定或弄虚作假，在flush的时候，有几率被没收押金，强制退出这条应用链的服务。这时，可以调用应用链控制合约的registeradd方法，将scs池子里的其他scs作为备用节点来为这条应用链服务。

部署应用链方可以调用应用链控制合约的close方法关闭这条应用链。此时会进入清算状态，待所有应用链收益结清后，即关闭应用链。请注意，应用链业务逻辑清算不包含。

应用链节点本身可以调用应用链控制合约的withdraw方法来结束为某一应用链服务，并得到返还的押金。


应用链中的MOAC押金和消耗
-------------------------------

为了使应用链安全稳定的运行，MOAC引入的押金机制，主要体现在以下几个方面：

1、每个应用链节点在第一次启动后，将会有一个唯一的MOAC钱包地址，在部署应用链前，需要在向这个地址打入至少1个MOAC作为运行费用；

2、每个应用链节点注册进入应用链矿工池时，需要向矿工池缴纳一定的押金，最小值由应用链控制合约设置，最大值不限。应用链节点每被选中一次，将会扣除一定数额的押金，当押金被扣完后，该节点将不会再参与新的应用链，退出应用链时，可以调用方法取回押金；

3、当一个应用链节点注册成一个监听节点时，需要缴纳一定的押金；当退出应用链时可以取回押金；

4、押金一般不会扣除，但在flush时，如果有企图作弊的节点，将会按照规则踢出应用链，并扣除押金，不再返还；

维护应用链的MOAC消耗：

首先，调用应用链方法不会消耗任何gas，但是，dapp运营方需要向应用链控制合约地址打入一定量的MOAC维持应用链运行，这部分MOAC将会消耗在给应用链矿工费用、应用链向母链flush状态，以及母链充提gas返还上。这个维护消耗可以通过调整应用链的flush周期来部分改变。


应用链部署的注意点
---------------------------------

1、应用链scs的vnode需要互相addPeer以保证通讯畅通。同时，这些vnode建议尽量add外面的节点以保证主链高度一致，并且保证时钟同步。

2、应用链scs的时钟请同步互联网标准时间。